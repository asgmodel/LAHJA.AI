<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¹Ø¯ Ù„Ù‡Ø¬Ø© - Ù…Ø­Ø§Ø¯Ø«Ø© Ø°ÙƒÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="ModulLahja.css">
  <style>
        :root {
            --primary-color: #10B981;
            --primary-dark: #059669;
            --secondary-color: #8B5CF6;
            --accent-color: #F59E0B;
            --background: #FFFFFF;
            --surface: #F8FAFC;
            --surface-dark: #F1F5F9;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border: #E2E8F0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --background: #0F172A;
            --surface: #1E293B;
            --surface-dark: #334155;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-muted: #64748B;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            transition: var(--transition);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
            background: var(--background);
            position: relative;
            overflow: hidden;
        }

            .app-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
                pointer-events: none;
            }

        /* Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
        .sidebar {
            width: 320px;
            background: var(--surface);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            position: relative;
            z-index: 10;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
        }

            .sidebar-header h2 {
                color: var(--text-primary);
                font-size: 1.5rem;
                font-weight: 700;
                margin-bottom: 16px;
            }

        .new-chat-btn {
            width: 100%;
            padding: 12px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

            .new-chat-btn:hover {
                background: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: var(--shadow);
            }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .conversation-item {
            padding: 16px;
            margin-bottom: 8px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

            .conversation-item::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 3px;
                height: 100%;
                background: var(--primary-color);
                opacity: 0;
                transition: var(--transition);
            }

            .conversation-item:hover {
                transform: translateX(-4px);
                box-shadow: var(--shadow);
            }

                .conversation-item:hover::before {
                    opacity: 1;
                }

            .conversation-item.active {
                background: var(--surface-dark);
                border-color: var(--primary-color);
            }

                .conversation-item.active::before {
                    opacity: 1;
                }

        .conversation-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

            .conversation-title span {
                font-weight: 600;
                color: var(--text-primary);
                flex: 1;
            }

        .delete-conversation {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

            .delete-conversation:hover {
                color: #EF4444;
                background: rgba(239, 68, 68, 0.1);
            }

        .conversation-preview {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-amp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .conversation-date {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }

            .menu-toggle:hover {
                background: var(--surface-dark);
            }

        .logo i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .logo h1 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .user-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: var(--surface-dark);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

            .btn-secondary:hover {
                background: var(--border);
                transform: translateY(-1px);
            }

        .settings-toggle-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

            .settings-toggle-btn:hover {
                background: var(--primary-dark);
                transform: translateY(-1px);
            }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Øª */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

            .chat-title i {
                color: var(--primary-color);
                font-size: 1.25rem;
            }

            .chat-title span {
                color: var(--text-primary);
                font-size: 1.125rem;
                font-weight: 600;
            }

        .chat-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-btn {
            background: var(--surface-dark);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

            .action-btn:hover {
                background: var(--border);
                transform: scale(1.05);
            }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø´Ø§Øª */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: var(--background);
            position: relative;
        }

        .speaking-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 16px;
            animation: pulse 2s infinite;
        }

            .speaking-indicator.active {
                display: flex;
            }

            .speaking-indicator i {
                color: var(--primary-color);
            }

            .speaking-indicator span {
                color: var(--text-primary);
                font-weight: 500;
            }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .message {
            max-width: 80%;
            margin-bottom: 24px;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            margin-right: auto;
        }

        .assistant-message {
            margin-left: auto;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-sender {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .message-actions {
            display: flex;
            gap: 4px;
        }

        .message-action {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
            font-size: 0.875rem;
        }

            .message-action:hover {
                color: var(--primary-color);
                background: rgba(16, 185, 129, 0.1);
            }

        /* ØªØ­Ø³ÙŠÙ† ØªØµÙ…ÙŠÙ… Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .message-action.download-audio:hover {
            color: var(--secondary-color);
            background: rgba(139, 92, 246, 0.1);
        }

        .message-content {
            background: var(--surface);
            padding: 16px 20px;
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            line-height: 1.6;
            box-shadow: var(--shadow);
            position: relative;
            border: 1px solid var(--border);
        }

        .user-message .message-content {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
        }

        .assistant-message .message-content {
            background: var(--surface);
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
            text-align: left;
        }

        .user-message .message-time {
            text-align: right;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .chat-input-area {
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 24px;
            position: relative;
        }

        .input-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .input-mode-toggle {
            display: flex;
            background: var(--surface-dark);
            border-radius: var(--radius);
            padding: 4px;
            border: 1px solid var(--border);
        }

        .mode-btn {
            padding: 8px 16px;
            background: none;
            border: none;
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

            .mode-btn.active {
                background: var(--primary-color);
                color: white;
            }

        .input-actions {
            display: flex;
            gap: 8px;
        }

        .input-action-btn {
            background: var(--surface-dark);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

            .input-action-btn:hover {
                background: var(--border);
                transform: scale(1.05);
            }

        /* ØªØ­Ø³ÙŠÙ† ØªØµÙ…ÙŠÙ… Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª */
        #downloadAudioBtn:hover {
            background: var(--secondary-color);
            color: white;
        }

        .chat-input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 12px;
            transition: var(--transition);
            position: relative;
        }

            .chat-input-wrapper:focus-within {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }

        .chat-input {
            flex: 1;
            border: none;
            background: none;
            color: var(--text-primary);
            font-size: 1rem;
            line-height: 1.5;
            resize: none;
            min-height: 60px;
            max-height: 120px;
            outline: none;
            font-family: inherit;
        }

            .chat-input::placeholder {
                color: var(--text-muted);
            }

        .voice-input-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 20px;
            width: 100%;
        }

        .voice-visualization {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 40px;
            width: 100%;
            justify-content: center;
        }

        .voice-bar {
            width: 3px;
            background: var(--primary-color);
            border-radius: 2px;
            transition: height 0.1s ease;
        }

        .voice-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .voice-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow);
        }

            .voice-btn:hover {
                background: var(--primary-dark);
                transform: scale(1.05);
            }

            .voice-btn.recording {
                background: #EF4444;
                animation: pulse 1s infinite;
            }

        #recordingStatus {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            width: 44px;
            height: 44px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

            .send-btn:hover {
                background: var(--primary-dark);
                transform: scale(1.05);
            }

            .send-btn:disabled {
                background: var(--text-muted);
                cursor: not-allowed;
                transform: none;
            }

        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

            .status i {
                font-size: 0.75rem;
            }

        /* Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: var(--surface);
            border-right: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            z-index: 1000;
            overflow-y: auto;
        }

            .settings-panel.active {
                left: 0;
            }

        .settings-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

            .settings-header h2 {
                color: var(--text-primary);
                font-size: 1.5rem;
                font-weight: 700;
            }

        .close-settings {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }

            .close-settings:hover {
                background: var(--surface-dark);
            }

        .settings-content {
            padding: 24px;
        }

        .settings-section {
            margin-bottom: 32px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

            .section-title i {
                color: var(--primary-color);
                font-size: 1.25rem;
            }

            .section-title span {
                color: var(--text-primary);
                font-size: 1.125rem;
                font-weight: 600;
            }

        .form-group {
            margin-bottom: 20px;
        }

            .form-group label {
                display: block;
                color: var(--text-primary);
                font-weight: 500;
                margin-bottom: 8px;
            }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--background);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

            .form-control:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }

        .dialect-options, .voice-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 8px;
        }

        .dialect-option, .voice-option {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--background);
        }

            .dialect-option:hover, .voice-option:hover {
                border-color: var(--primary-color);
                transform: translateY(-2px);
            }

            .dialect-option.active, .voice-option.active {
                border-color: var(--primary-color);
                background: rgba(16, 185, 129, 0.1);
            }

        .dialect-flag, .voice-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .alert {
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }

        /* Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: var(--transition);
            border-radius: 24px;
        }

            .slider:before {
                position: absolute;
                content: "";
                height: 16px;
                width: 16px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: var(--transition);
                border-radius: 50%;
            }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

            input:checked + .slider:before {
                transform: translateX(26px);
            }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ */
        .subscription-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

            .subscription-modal.active {
                opacity: 1;
                visibility: visible;
            }

        .subscription-content {
            background: var(--surface);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .subscription-header {
            padding: 24px;
            background: var(--primary-color);
            color: white;
            text-align: center;
        }

            .subscription-header h2 {
                font-size: 1.5rem;
                margin-bottom: 8px;
            }

        .subscription-body {
            padding: 24px;
        }

        .token-input-group {
            margin-bottom: 20px;
        }

            .token-input-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                color: var(--text-primary);
            }

        .token-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            background: var(--background);
            color: var(--text-primary);
        }

            .token-input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }

        .subscription-footer {
            padding: 16px 24px;
            background: var(--surface-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .requests-counter {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

            .requests-counter .remaining {
                font-weight: 600;
                color: var(--primary-color);
            }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .mobile-requests-counter {
            display: none;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: var(--surface-dark);
            padding: 6px 10px;
            border-radius: 20px;
            border: 1px solid var(--border);
        }

            .mobile-requests-counter .remaining {
                font-weight: 600;
                color: var(--primary-color);
            }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                right: -320px;
                top: 0;
                height: 100vh;
                z-index: 100;
            }

                .sidebar.active {
                    right: 0;
                }

            .settings-panel {
                width: 100%;
                left: -100%;
            }

            .message {
                max-width: 90%;
            }

            .user-controls {
                display: none;
            }

            .dialect-options, .voice-options {
                grid-template-columns: 1fr;
            }

            .mobile-requests-counter {
                display: flex;
            }

            .chat-actions {
                gap: 6px;
            }
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: var(--text-muted);
            }
    </style>
   <style>
        /* CSS ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ */
        :root {
            --primary-color: #10B981;
            --primary-dark: #059669;
            --secondary-color: #8B5CF6;
            --accent-color: #F59E0B;
            --background: #FFFFFF;
            --surface: #F8FAFC;
            --surface-dark: #F1F5F9;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border: #E2E8F0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --background: #0F172A;
            --surface: #1E293B;
            --surface-dark: #334155;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-muted: #64748B;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            transition: var(--transition);
        }

        /* Ø¨Ø§Ù‚ÙŠ CSS ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ */
        /* ... */
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</h2>
                 <button class="close-settings sidebar2" onclick="closesidebar()">
                    <i class="fas fa-times"></i>
                </button>
                <button class="new-chat-btn" id="newChatBtn">
                    <i class="fas fa-plus"></i> Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>
            <div class="conversations-list" id="conversationsList">
                <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù‡Ù†Ø§ -->
            </div>
            <div class="sidebar-footer">
                <div class="requests-counter">
                    <i class="fas fa-bolt"></i>
                    <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span class="remaining" id="remainingRequests">10</span></span>
                </div>
                <button class="btn btn-secondary" id="toggleTheme">
                    <i class="fas fa-moon"></i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©
                </button>
                <button class="btn btn-secondary" id="openSettings">
                    <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content">
            <div class="header">
                <div class="logo">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <img src="logo.png" style="width:50px;height:50px" />
                    <h1>Ù…Ø³Ø§Ø¹Ø¯ Ù„Ù‡Ø¬Ø©</h1>
                </div>
                <div class="user-controls">
                    <div class="requests-counter">
                        <i class="fas fa-bolt"></i>
                        <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span class="remaining" id="headerRemainingRequests">10</span></span>
                    </div>
                    <button class="settings-toggle-btn" id="headerSettingsBtn">
                        <i class="fas fa-cog"></i>
                        ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                    <button class="btn btn-secondary" id="clearChat">
                        <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                    </button>
                </div>
            </div>

            <div class="chat-area">
                <div class="chat-header">
                    <div class="chat-title">
                        <i class="fas fa-comments"></i>
                        <span id="currentConversationTitle">Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </div>
                    <div class="chat-actions">
                        <div class="mobile-requests-counter">
                            <i class="fas fa-bolt"></i>
                            <span class="remaining" id="mobileRemainingRequests">10</span>
                        </div>
                        <button class="action-btn" id="toggleThemeSmall" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button class="action-btn" id="settingsBtn" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="speaking-indicator" id="speakingIndicator">
                        <i class="fas fa-volume-up fa-pulse"></i>
                        <span>Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø¯ Ø§Ù„ØµÙˆØªÙŠ...</span>
                    </div>

                    <!-- Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
                    <div class="message assistant-message">
                        <div class="message-header">
                            <div class="message-sender">Ù…Ø³Ø§Ø¹Ø¯ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                            <div class="message-actions">
                                <button class="message-action" title="Ø§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø¯" onclick="SaudiVoiceAssistant.speakResponse('Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø±Ø¯ ÙƒØªØ§Ø¨ÙŠØ§Ù‹ ÙˆÙ†Ø·Ù‚ Ø§Ù„Ø±Ø¯ÙˆØ¯ ØµÙˆØªÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ØµÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø©!')">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <button class="message-action download-audio" title="ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª" onclick="SaudiVoiceAssistant.downloadMessageAudio('Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø±Ø¯ ÙƒØªØ§Ø¨ÙŠØ§Ù‹ ÙˆÙ†Ø·Ù‚ Ø§Ù„Ø±Ø¯ÙˆØ¯ ØµÙˆØªÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ØµÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø©!')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="message-content">
                            Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! ğŸ‰ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©.
                            ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø±Ø¯ ÙƒØªØ§Ø¨ÙŠØ§Ù‹ ÙˆÙ†Ø·Ù‚ Ø§Ù„Ø±Ø¯ÙˆØ¯ ØµÙˆØªÙŠØ§Ù‹.
                            ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ØµÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø©!
                        </div>
                        <div class="message-time" id="currentTime"></div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <div class="input-options">
                        <div class="input-mode-toggle">
                            <button class="mode-btn active" data-mode="text">
                                <i class="fas fa-keyboard"></i> Ù†Øµ
                            </button>
                            <button class="mode-btn" data-mode="voice">
                                <i class="fas fa-microphone"></i> ØµÙˆØª
                            </button>
                        </div>
                        <div class="input-actions">
                            <button class="input-action-btn" title="Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="input-action-btn" title="Ø¥Ø¶Ø§ÙØ© ØªØ¹Ø¨ÙŠØ±">
                                <i class="fas fa-smile"></i>
                            </button>
                            <button class="input-action-btn" id="popupOpener" title="ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª">
                                ğŸ¤
                            </button>
                        </div>
                    </div>

                    <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ -->
                    <div class="voice-popup" id="voicePopup">
                        <div class="popup-header">
                            <div class="popup-title">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ø°ÙƒÙŠ</div>
                            <div class="popup-controls">
                                <button class="popup-btn" id="themeToggle">ğŸŒ™</button>
                                <button class="popup-btn" id="minimizeBtn">âˆ’</button>
                                <button class="popup-btn" id="closeBtn">âœ•</button>
                            </div>
                        </div>

                        <div class="popup-content">
                            <div class="background-effect"></div>
                            
                            <!-- Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© -->
                            <div class="permission-indicator" id="permissionIndicator"></div>
                            <div class="session-indicator" id="sessionIndicator"></div>

                            <!-- Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† -->
                              <div class="mic-container">
        <div class="permission-indicator" id="permissionIndicator"></div>
        <div class="session-indicator" id="sessionIndicator"></div>
        <div class="circle-outer" id="micCircle">
            <div class="pulse-wave"></div>
            <div class="pulse-wave"></div>
            <div class="pulse-wave"></div>
            <div class="circle-middle">
                <div class="circle-inner">
                    <svg class="mic-svg" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="img">
                        <title>API</title>
                        <path d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"></path>
                    </svg>
                </div>
            </div>
        </div>
        <div class="mic-tooltip" id="micTooltip">Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯</div>
        <div class="mic-label" id="micLabel">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</div>
    </div>

                            <!-- <div class="mic-container">
                                <div class="circle-outer" id="micCircle">
                                    <div class="pulse-wave"></div>
                                    <div class="pulse-wave"></div>
                                    <div class="pulse-wave"></div>
                                    <div class="circle-middle">
                                        <div class="circle-inner">
                                            <svg class="mic-svg" viewBox="0 0 24 24">
                                                <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div> -->

                            <!-- Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„ØµÙˆØª -->
                            <div class="wave hidden" id="wave">
                                <span></span><span></span><span></span><span></span><span></span>
                            </div>

                            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
                            <div class="status" id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...</div>

                            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
                            <div class="session-controls">
                                <button class="session-btn" id="startSessionBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
                                <button class="session-btn" id="stopSessionBtn">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬Ù„Ø³Ø©</button>
                            </div>

                            <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
                            <div class="browser-warning" id="browserWarning">
                                Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Chrome Ø£Ùˆ Edge.
                            </div>
                            <div class="permission-notice" id="permissionNotice">
                                ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-wrapper">
                        <textarea class="chat-input" id="messageInput"
                                  placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                        <div class="voice-input-container" id="voiceInputContainer">
                            <div class="voice-visualization" id="voiceVisualization">
                                <!-- Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØµÙˆØª -->
                            </div>
                            <div class="voice-controls">
                                <button class="voice-btn" id="startRecording">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <span id="recordingStatus">Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ø¯Ø«</span>
                            </div>
                        </div>
                        <button class="send-btn" id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>

                    <div class="status" id="chatStatus">
                        <i class="fas fa-circle" style="color: #10B981;"></i>
                        <span>Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                <button class="close-settings" id="closeSettings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <div class="section-title">
                        <i class="fas fa-key"></i>
                        <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª LAHJA</span>
                    </div>

                    <div class="alert alert-error" id="configError" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="errorText"></span>
                    </div>

                    <div class="form-group">
                        <label for="endpoint">Endpoint</label>
                        <input type="text" id="endpoint" class="form-control"
                               placeholder="https://your-resource.openai.azure.com/"
                               value="https://lahja-dev-resource.cognitiveservices.azure.com/">
                    </div>

                    <div class="form-group">
                        <label for="apiKey">API Key</label>
                        <input type="password" id="apiKey" class="form-control"
                               placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
                    </div>

                    <div class="form-group">
                        <label for="deployment">Deployment Name (Ù„Ù„Ù†Øµ)</label>
                        <input type="text" id="deployment" class="form-control"
                               placeholder="Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„Ù†Øµ"
                               value="Wasm-V1">
                    </div>

                    <div class="form-group">
                        <label for="ttsDeployment">Deployment Name (Ù„Ù„ØµÙˆØª)</label>
                        <input type="text" id="ttsDeployment" class="form-control"
                               placeholder="Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„ØµÙˆØª"
                               value="LAHJA-V1">
                    </div>

                    <div class="form-group">
                        <label for="apiVersion">API Version</label>
                        <input type="text" id="apiVersion" class="form-control"
                               placeholder="Ø¥ØµØ¯Ø§Ø± API"
                               value="2024-02-01">
                    </div>

                    <button class="btn" id="saveConfig" style="width: 100%;">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                </div>

                <div class="settings-section">
                    <div class="section-title">
                        <i class="fas fa-language"></i>
                        <span>ØªØ®ØµÙŠØµ Ø§Ù„Ù„Ù‡Ø¬Ø©</span>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</label>
                        <div class="dialect-options">
                            <div class="dialect-option active" data-dialect="najdi">
                                <div class="dialect-flag">ğŸœï¸</div>
                                <div>Ù†Ø¬Ø¯ÙŠ</div>
                            </div>
                            <div class="dialect-option" data-dialect="hijazi">
                                <div class="dialect-flag">ğŸŒŠ</div>
                                <div>Ø­Ø¬Ø§Ø²ÙŠ</div>
                            </div>
                            <div class="dialect-option" data-dialect="southern">
                                <div class="dialect-flag">â›°ï¸</div>
                                <div>Ø¬Ù†ÙˆØ¨ÙŠ</div>
                            </div>
                            <div class="dialect-option" data-dialect="eastern">
                                <div class="dialect-flag">ğŸ›¢ï¸</div>
                                <div>Ø´Ø±Ù‚ÙŠ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="section-title">
                        <i class="fas fa-volume-up"></i>
                        <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</span>
                    </div>

                    <div class="form-group">
                        <label>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ:</label>
                        <div class="form-control" style="display: flex; align-items: center; gap: 10px; padding: 10px;">
                            <label class="switch">
                                <input type="checkbox" id="ttsEnabled" checked>
                                <span class="slider"></span>
                            </label>
                            <span>ØªÙØ¹ÙŠÙ„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØª:</label>
                        <div class="voice-options">
                            <div class="voice-option active" data-voice="alloy">
                                <div class="voice-icon">ğŸ‘¨</div>
                                <div>Alloy (Ø°ÙƒØ±)</div>
                            </div>
                            <div class="voice-option" data-voice="echo">
                                <div class="voice-icon">ğŸ‘¨</div>
                                <div>Echo (Ø°ÙƒØ±)</div>
                            </div>
                            <div class="voice-option" data-voice="fable">
                                <div class="voice-icon">ğŸ‘¨</div>
                                <div>Fable (Ø°ÙƒØ±)</div>
                            </div>
                            <div class="voice-option" data-voice="onyx">
                                <div class="voice-icon">ğŸ‘¨</div>
                                <div>Onyx (Ø°ÙƒØ±)</div>
                            </div>
                            <div class="voice-option" data-voice="nova">
                                <div class="voice-icon">ğŸ‘©</div>
                                <div>Nova (Ø£Ù†Ø«Ù‰)</div>
                            </div>
                            <div class="voice-option" data-voice="shimmer">
                                <div class="voice-icon">ğŸ‘©</div>
                                <div>Shimmer (Ø£Ù†Ø«Ù‰)</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="speechSpeed">Ø³Ø±Ø¹Ø© Ø§Ù„ØµÙˆØª:</label>
                        <input type="range" id="speechSpeed" min="0.5" max="2" step="0.1" value="1" class="form-control">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>Ø¨Ø·ÙŠØ¡</span>
                            <span id="speedValue">Ø¹Ø§Ø¯ÙŠ</span>
                            <span>Ø³Ø±ÙŠØ¹</span>
                        </div>
                    </div>

                    <button class="btn btn-secondary" id="testVoice" style="width: 100%;">
                        <i class="fas fa-play"></i> ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØµÙˆØª
                    </button>
                </div>

                <div class="settings-section">
                    <div class="section-title">
                        <i class="fas fa-info-circle"></i>
                        <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 15px;">
                        Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ³ØªØ®Ø¯Ù…  LAHJA Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù†ØµÙŠØ© ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù….
                    </p>

                    <div class="status" id="systemStatus">
                        <i class="fas fa-circle"></i>
                        <span>â³ ÙŠØ±Ø¬Ù‰ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
        <div class="subscription-modal" id="subscriptionModal">
            <div class="subscription-content">
                <div class="subscription-header">
                    <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</h2>
                    <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                </div>
                <div class="subscription-body">
                    <div class="token-input-group">
                        <label for="subscriptionToken">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„:</label>
                        <input type="text" id="subscriptionToken" class="token-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù‡Ù†Ø§">
                    </div>
                </div>
                <div class="subscription-footer">
                    <button class="btn btn-secondary" id="cancelSubscription">
                        Ø¥ØºÙ„Ø§Ù‚
                    </button>
                    <button class="btn" id="confirmSubscription">
                        <i class="fas fa-check"></i> ØªÙØ¹ÙŠÙ„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
         function closesidebar() {
 
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.classList.toggle('active');
                }
            }    
        // Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­
        const SaudiVoiceAssistant = {
            // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            config: {
                endpoint: 'https://lahja-dev-resource.cognitiveservices.azure.com/',
                apiKey: '4AwsIf87cyBIgaJVsy0phWUQdZFcbrJxpQBDQNzL4xjcP2MFzrrYJQQJ99BIACHYHv6XJ3w3AAAAACOGYrzM',
                deployment: 'Wasm-V1',
                ttsDeployment: 'LAHJA-V1',
                apiVersion: '2024-02-01',
                dialect: 'najdi',
                ttsEnabled: true,
                voice: 'echo',
                speechSpeed: 0.8,
                theme: 'light'
            },

            // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            state: {
                audio: null,
                isPlaying: false,
                currentAudioUrl: null,
                isRecording: false,
                mediaRecorder: null,
                audioChunks: [],
                currentConversationId: null,
                conversations: {},
                inputMode: 'text',
                isSpeaking: false,
                transcribedText: '',
                recognition: null,
                remainingRequests: 10,
                isSubscribed: false,
                subscriptionToken: null,
                messageAudioUrls: {}, // ØªØ®Ø²ÙŠÙ† Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØª Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©
                eventListeners: {} // Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ù…Ø¶Ø§ÙÙŠÙ†
            },

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            init() {
                this.loadConfig();
                this.loadSubscriptionData();
                this.loadConversations();
                this.setupEventListeners();
                this.updateUI();
                this.updateTime();
                this.applyTheme();
                this.setupVoiceVisualization();
                this.setupSpeechRecognition();

                // Ø¶Ø¨Ø· Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
                this.adjustHeights();

                // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
                window.addEventListener('resize', () => {
                    this.adjustHeights();
                });

                setInterval(() => this.updateTime(), 60000);

                console.log('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
            },

            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            loadSubscriptionData() {
                const subscriptionData = localStorage.getItem('saudiVoiceAssistantSubscription');
                if (subscriptionData) {
                    try {
                        const data = JSON.parse(subscriptionData);
                        this.state.remainingRequests = data.remainingRequests || 10;
                        this.state.isSubscribed = data.isSubscribed || false;
                        this.state.subscriptionToken = data.subscriptionToken || null;
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:', error);
                    }
                }
                this.updateRequestsCounter();
            },

            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            saveSubscriptionData() {
                try {
                    const subscriptionData = {
                        remainingRequests: this.state.remainingRequests,
                        isSubscribed: this.state.isSubscribed,
                        subscriptionToken: this.state.subscriptionToken
                    };
                    localStorage.setItem('saudiVoiceAssistantSubscription', JSON.stringify(subscriptionData));
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:', error);
                }
            },

            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            updateRequestsCounter() {
                const counters = document.querySelectorAll('.remaining');
                counters.forEach(counter => {
                    counter.textContent = this.state.remainingRequests;
                });

                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬ÙˆØ§Ù„
                const mobileCounter = document.getElementById('mobileRemainingRequests');
                if (mobileCounter) {
                    mobileCounter.textContent = this.state.remainingRequests;
                }

                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
                const messageInput = document.getElementById('messageInput');
                const sendButton = document.getElementById('sendButton');

                if (this.state.remainingRequests <= 0 && !this.state.isSubscribed) {
                    if (messageInput) {
                        messageInput.disabled = true;
                        messageInput.placeholder = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
                    }
                    if (sendButton) {
                        sendButton.disabled = true;
                    }
                } else {
                    if (messageInput) {
                        messageInput.disabled = false;
                        messageInput.placeholder = 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...';
                    }
                    if (sendButton) {
                        sendButton.disabled = false;
                    }
                }
            },

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ù„Ø¨
            useRequest() {
                if (this.state.isSubscribed) {
                    return true; // Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©
                }

                if (this.state.remainingRequests > 0) {
                    this.state.remainingRequests--;
                    this.updateRequestsCounter();
                    this.saveSubscriptionData();
                    return true;
                } else {
                    this.showSubscriptionModal();
                    return false;
                }
            },

            // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            showSubscriptionModal() {
                const modal = document.getElementById('subscriptionModal');
                if (modal) {
                    modal.classList.add('active');
                }
            },

            // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            hideSubscriptionModal() {
                const modal = document.getElementById('subscriptionModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            },

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠ
            downloadCurrentAudio() {
                if (!this.state.currentAudioUrl) {
                    this.showError('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØª Ù…ØªØ§Ø­ Ù„Ù„ØªØ­Ù…ÙŠÙ„');
                    return;
                }

                try {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„
                    const downloadLink = document.createElement('a');
                    downloadLink.href = this.state.currentAudioUrl;
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… Ù…Ù„Ù Ù…Ø¹ ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª
                    const now = new Date();
                    const timestamp = now.toISOString().replace(/[:.]/g, '-');
                    const filename = `Ù…Ø³Ø§Ø¹Ø¯-Ù„Ù‡Ø¬Ø©-${timestamp}.mp3`;
                    
                    downloadLink.download = filename;
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    
                    this.showSuccess('ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ');
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª:', error);
                    this.showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª');
                }
            },

            // ØªØ­Ù…ÙŠÙ„ ØµÙˆØª Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ø¯Ø¯Ø©
            async downloadMessageAudio(text) {
                if (!text || text.trim() === '') {
                    this.showError('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØµÙˆØª');
                    return;
                }

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                if (!this.useRequest()) {
                    return;
                }

                try {
                    this.showSuccess('Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØª Ù„Ù„ØªØ­Ù…ÙŠÙ„...');

                    const ttsEndpoint = "https://lahja-dev-resource.cognitiveservices.azure.com/openai/deployments/LAHJA-V1/audio/speech?api-version=2025-03-01-preview";

                    const requestBody = {
                        model: this.config.ttsDeployment,
                        input: text,
                        voice: this.config.voice,
                        speed: this.config.speechSpeed,
                        response_format: "mp3"
                    };

                    const ttsResponse = await fetch(ttsEndpoint, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer 4AwsIf87cyBIgaJVsy0phWUQdZFcbrJxpQBDQNzL4xjcP2MFzrrYJQQJ99BIACHYHv6XJ3w3AAAAACOGYrzM"
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!ttsResponse.ok) {
                        throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„ØµÙˆØª (${ttsResponse.status})`);
                    }

                    const audioBlob = await ttsResponse.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);

                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                    const downloadLink = document.createElement('a');
                    downloadLink.href = audioUrl;
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… Ù…Ù„Ù Ù…Ø¹ Ù†Øµ Ù…Ø®ØªØµØ±
                    const shortText = text.substring(0, 30).replace(/[^\w\u0600-\u06FF]/g, '_');
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    const filename = `Ù…Ø³Ø§Ø¹Ø¯-Ù„Ù‡Ø¬Ø©-${shortText}-${timestamp}.mp3`;
                    
                    downloadLink.download = filename;
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);

                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    setTimeout(() => {
                        URL.revokeObjectURL(audioUrl);
                    }, 1000);

                    this.showSuccess('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ Ø¨Ù†Ø¬Ø§Ø­');

                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙˆØª Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
                    this.showError(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª: ${error.message}`);
                }
            },

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…
            setupSpeechRecognition() {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Web Speech API
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.state.recognition = new SpeechRecognition();

                    this.state.recognition.continuous = false;
                    this.state.recognition.interimResults = false;
                    this.state.recognition.lang = 'ar-SA';
                    this.state.recognition.maxAlternatives = 1;

                    this.state.recognition.onstart = () => {
                        console.log('Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…...');
                        document.getElementById('recordingStatus').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...';
                        this.animateVoiceBars();
                    };

                    this.state.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        console.log('Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­ÙˆÙ„:', transcript);

                        // ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                        const messageInput = document.getElementById('messageInput');
                        if (messageInput) {
                            messageInput.value = transcript;
                            messageInput.focus();
                        }

                        document.getElementById('recordingStatus').textContent = 'ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ âœ“';
                        this.stopVoiceBarsAnimation();

                        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                        setTimeout(() => {
                            this.switchToTextMode();
                            document.getElementById('recordingStatus').textContent = 'Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ø¯Ø«';
                        }, 2000);
                    };

                    this.state.recognition.onerror = (event) => {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…:', event.error);
                        document.getElementById('recordingStatus').textContent = 'Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ø¯Ø«';
                        this.stopVoiceBarsAnimation();

                        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…';
                        if (event.error === 'not-allowed') {
                            errorMessage = 'ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†';
                        } else if (event.error === 'no-speech') {
                            errorMessage = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£ÙŠ ÙƒÙ„Ø§Ù…';
                        } else if (event.error === 'audio-capture') {
                            errorMessage = 'ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†';
                        }

                        this.showError(errorMessage);
                    };

                    this.state.recognition.onend = () => {
                        console.log('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…');
                        this.state.isRecording = false;
                        const recordButton = document.getElementById('startRecording');
                        if (recordButton) recordButton.classList.remove('recording');
                        this.stopVoiceBarsAnimation();
                    };
                } else {
                    console.warn('Web Speech API ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
                    document.getElementById('recordingStatus').textContent = 'Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©';
                    this.showError('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø­Ø¯ÙŠØ« Ù…Ø«Ù„ Chrome Ø£Ùˆ Edge.');
                }
            },

            // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ
            switchToTextMode() {
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.mode === 'text') {
                        btn.classList.add('active');
                    }
                });
                this.state.inputMode = 'text';
                this.toggleInputMode();
            },

            // Ø¶Ø¨Ø· Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
            adjustHeights() {
                const header = document.querySelector('.header');
                const chatHeader = document.querySelector('.chat-header');
                const chatInputArea = document.querySelector('.chat-input-area');

                if (header && chatHeader && chatInputArea) {
                    const headerHeight = header.offsetHeight;
                    const chatHeaderHeight = chatHeader.offsetHeight;
                    const inputAreaHeight = chatInputArea.offsetHeight;
                    const chatMessages = document.getElementById('chatMessages');

                    if (chatMessages) {
                        const availableHeight = window.innerHeight - headerHeight - chatHeaderHeight - inputAreaHeight;
                        chatMessages.style.maxHeight = `${availableHeight}px`;
                    }
                }
            },

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            loadConfig() {
                const savedConfig = localStorage.getItem('saudiVoiceAssistantConfig');
                if (savedConfig) {
                    try {
                        this.config = { ...this.config, ...JSON.parse(savedConfig) };
                        this.populateForm();
                        console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', this.config);
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                    }
                }
            },

            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            saveConfig() {
                try {
                    localStorage.setItem('saudiVoiceAssistantConfig', JSON.stringify(this.config));
                    console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                }
            },

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            loadConversations() {
                const savedConversations = localStorage.getItem('saudiVoiceAssistantConversations');
                if (savedConversations) {
                    try {
                        this.state.conversations = JSON.parse(savedConversations);
                        this.renderConversationsList();

                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø§Ù„Ù†Ø´Ø·Ø©
                        const lastActive = localStorage.getItem('saudiVoiceAssistantLastActive');
                        if (lastActive && this.state.conversations[lastActive]) {
                            this.loadConversation(lastActive);
                        } else if (Object.keys(this.state.conversations).length > 0) {
                            const firstKey = Object.keys(this.state.conversations)[0];
                            this.loadConversation(firstKey);
                        } else {
                            this.createNewConversation();
                        }
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª:', error);
                        this.createNewConversation();
                    }
                } else {
                    this.createNewConversation();
                }
            },

            // Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            saveConversations() {
                try {
                    localStorage.setItem('saudiVoiceAssistantConversations', JSON.stringify(this.state.conversations));
                    if (this.state.currentConversationId) {
                        localStorage.setItem('saudiVoiceAssistantLastActive', this.state.currentConversationId);
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª:', error);
                }
            },

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            populateForm() {
                document.getElementById('endpoint').value = this.config.endpoint;
                document.getElementById('apiKey').value = this.config.apiKey;
                document.getElementById('deployment').value = this.config.deployment;
                document.getElementById('ttsDeployment').value = this.config.ttsDeployment;
                document.getElementById('apiVersion').value = this.config.apiVersion;
                document.getElementById('ttsEnabled').checked = this.config.ttsEnabled;
                document.getElementById('speechSpeed').value = this.config.speechSpeed;
                this.updateSpeedValue();

                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù†Ø´Ø·Ø©
                document.querySelectorAll('.dialect-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.dialect === this.config.dialect) {
                        option.classList.add('active');
                    }
                });

                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØª Ø§Ù„Ù†Ø´Ø·
                document.querySelectorAll('.voice-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.voice === this.config.voice) {
                        option.classList.add('active');
                    }
                });
            },

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« - Ù…ØµØ­Ø­Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
            setupEventListeners() {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù†ÙˆØ§ Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ†
                this.removeEventListeners();

                // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                this.addEventListener('saveConfig', 'click', () => {
                    this.saveConfiguration();
                });

                // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
                this.addEventListener('sendButton', 'click', () => {
                    this.sendMessage();
                });

                // Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
                this.addEventListener('messageInput', 'keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª
                this.addEventListener('downloadAudioBtn', 'click', () => {
                    this.downloadCurrentAudio();
                });

                // ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    this.addTempEventListener(btn, 'click', (e) => {
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.state.inputMode = e.target.dataset.mode;
                        this.toggleInputMode();
                    });
                });

                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª
                this.addEventListener('startRecording', 'click', () => {
                    this.toggleRecording();
                });

                // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ù‡Ø¬Ø©
                document.querySelectorAll('.dialect-option').forEach(option => {
                    this.addTempEventListener(option, 'click', () => {
                        document.querySelectorAll('.dialect-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        option.classList.add('active');
                        this.config.dialect = option.dataset.dialect;
                        this.saveConfig();
                    });
                });

                // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØª
                document.querySelectorAll('.voice-option').forEach(option => {
                    this.addTempEventListener(option, 'click', () => {
                        document.querySelectorAll('.voice-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        option.classList.add('active');
                        this.config.voice = option.dataset.voice;
                        this.saveConfig();
                    });
                });

                // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ
                this.addEventListener('ttsEnabled', 'change', (e) => {
                    this.config.ttsEnabled = e.target.checked;
                    this.saveConfig();
                });

                // Ø³Ø±Ø¹Ø© Ø§Ù„ØµÙˆØª
                this.addEventListener('speechSpeed', 'input', (e) => {
                    this.config.speechSpeed = parseFloat(e.target.value);
                    this.updateSpeedValue();
                    this.saveConfig();
                });

                // ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØµÙˆØª
                this.addEventListener('testVoice', 'click', () => {
                    this.testVoice();
                });

                // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                this.addEventListener('clearChat', 'click', () => {
                    this.clearCurrentConversation();
                });

                // Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
                this.addEventListener('newChatBtn', 'click', () => {
                    this.createNewConversation();
                });

                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©
                this.addEventListener('toggleTheme', 'click', () => {
                    this.toggleTheme();
                });

                this.addEventListener('toggleThemeSmall', 'click', () => {
                    this.toggleTheme();
                });

                // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                this.addEventListener('headerSettingsBtn', 'click', () => {
                    this.openSettings();
                });

                this.addEventListener('openSettings', 'click', () => {
                    this.openSettings();
                });

                this.addEventListener('settingsBtn', 'click', () => {
                    this.openSettings();
                });

                this.addEventListener('closeSettings', 'click', () => {
                    this.closeSettings();
                });

                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
                this.addEventListener('menuToggle', 'click', () => {
                    this.toggleSidebar();
                });

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
                this.addTempEventListener(document, 'click', (e) => {
                    const settingsPanel = document.getElementById('settingsPanel');
                    const headerSettingsBtn = document.getElementById('headerSettingsBtn');
                    const openSettingsBtn = document.getElementById('openSettings');
                    const settingsBtn = document.getElementById('settingsBtn');

                    if (settingsPanel && settingsPanel.classList.contains('active') &&
                        !settingsPanel.contains(e.target) &&
                        headerSettingsBtn && !headerSettingsBtn.contains(e.target) &&
                        openSettingsBtn && !openSettingsBtn.contains(e.target) &&
                        settingsBtn && !settingsBtn.contains(e.target)) {
                        this.closeSettings();
                    }
                });

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Escape
                this.addTempEventListener(document, 'keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeSettings();
                    }
                });

                // Ø£Ø­Ø¯Ø§Ø« Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                this.addEventListener('cancelSubscription', 'click', () => {
                    this.hideSubscriptionModal();
                });

                this.addEventListener('confirmSubscription', 'click', () => {
                    this.processSubscription();
                });

                // Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„
                this.addEventListener('subscriptionToken', 'keydown', (e) => {
                    if (e.key === 'Enter') {
                        this.processSubscription();
                    }
                });
            },

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø­Ø¯Ø« Ù…Ø¹ ØªØªØ¨Ø¹
            addEventListener(elementId, eventType, handler) {
                const element = document.getElementById(elementId);
                if (element) {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    if (this.state.eventListeners[elementId]) {
                        element.removeEventListener(eventType, this.state.eventListeners[elementId]);
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØªØªØ¨Ø¹Ù‡
                    this.state.eventListeners[elementId] = handler;
                    element.addEventListener(eventType, handler);
                }
            },

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù…Ø¤Ù‚Øª (Ù„Ø§ ÙŠØªÙ… ØªØªØ¨Ø¹Ù‡)
            addTempEventListener(element, eventType, handler) {
                if (element) {
                    element.addEventListener(eventType, handler);
                }
            },

            // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
            removeEventListeners() {
                Object.keys(this.state.eventListeners).forEach(elementId => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ Ø¯ÙˆÙ† Ù…Ø¹Ø±ÙØ© Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø«ØŒ Ù„Ø°Ø§ Ù†ØªØ±ÙƒÙ‡Ø§ Ù„Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    }
                });
                this.state.eventListeners = {};
            },

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            processSubscription() {
                const tokenInput = document.getElementById('subscriptionToken');
                const token = tokenInput.value.trim();

                if (token) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆÙƒÙ† (Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆÙƒÙ†)
                    if (this.validateToken(token)) {
                        this.state.isSubscribed = true;
                        this.state.subscriptionToken = token;
                        this.state.remainingRequests = 999; // Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ù„Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø©
                        this.saveSubscriptionData();
                        this.updateRequestsCounter();
                        this.hideSubscriptionModal();
                        this.showSuccess('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­!');
                    } else {
                        this.showError('Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ§Ù„Ø­');
                    }
                } else {
                    this.showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„');
                }
            },

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆÙƒÙ† (Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© ÙˆÙ‡Ù…ÙŠØ© - ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ)
            validateToken(token) {
                // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ù†Ø§ ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…
                // Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ Ù…Ø¨Ø³Ø· Ù„Ù„ØªÙˆØ¶ÙŠØ­ ÙÙ‚Ø·
                return token.length >= 8 && /^[A-Za-z0-9]+$/.test(token);
            },

            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù…ØµØ­Ø­Ø©
            saveConfiguration() {
                const endpoint = document.getElementById('endpoint').value.trim();
                const apiKey = document.getElementById('apiKey').value.trim();
                const deployment = document.getElementById('deployment').value.trim();
                const ttsDeployment = document.getElementById('ttsDeployment').value.trim();
                const apiVersion = document.getElementById('apiVersion').value.trim();

                const errorElement = document.getElementById('configError');

                if (!endpoint || !apiKey || !deployment || !ttsDeployment || !apiVersion) {
                    this.showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                    return;
                }

                if (!endpoint.startsWith('https://')) {
                    this.showError('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Endpoint Ø¨Ù€ https://');
                    return;
                }

                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ endpoint
                let cleanEndpoint = endpoint.trim();
                if (!cleanEndpoint.endsWith('/')) {
                    cleanEndpoint += '/';
                }

                this.config.endpoint = cleanEndpoint;
                this.config.apiKey = apiKey;
                this.config.deployment = deployment;
                this.config.ttsDeployment = ttsDeployment;
                this.config.apiVersion = apiVersion;

                this.saveConfig();
                this.hideError();
                this.showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                this.updateUI();

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
                setTimeout(() => {
                    this.closeSettings();
                }, 1500);
            },

            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
            async sendMessage() {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                if (!this.useRequest()) {
                    return;
                }

                const messageInput = document.getElementById('messageInput');
                const userMessage = messageInput.value.trim();

                if (!userMessage) {
                    this.showError('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹');
                    return;
                }

                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø´Ø§Ø´Ø©
                this.addMessageToChat('user', userMessage);
                messageInput.value = '';

                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø°Ø§ÙƒØ±Ø©
                this.addMessageToCurrentConversation('user', userMessage);

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                this.setLoading(true);
                document.getElementById('chatStatus').innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¯...';

                try {
                    // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ API
                    const response = await this.callAzureOpenAI(userMessage);

                    // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ù„Ù„Ø´Ø§Ø´Ø© ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©
                    this.addMessageToChat('assistant', response);
                    this.addMessageToCurrentConversation('assistant', response);

                    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹
                    if (this.config.ttsEnabled) {
                        await this.speakResponse(response);
                    }

                    document.getElementById('chatStatus').innerHTML = '<i class="fas fa-check-circle"></i> Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©';

                } catch (error) {
                    console.error('Error:', error);
                    const errorMessage = error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
                    this.addMessageToChat('assistant', `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${errorMessage}`);
                    document.getElementById('chatStatus').innerHTML = '<i class="fas fa-exclamation-circle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£';
                    this.showError(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: ${errorMessage}`);
                } finally {
                    this.setLoading(false);
                }
            },

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Azure OpenAI API Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© - Ù…ØµØ­Ø­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
            async callAzureOpenAI(userMessage) {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                const validationErrors = this.validateConfig();
                if (validationErrors.length > 0) {
                    throw new Error(validationErrors.join(', '));
                }

                console.log('Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API...', {
                    endpoint: this.config.endpoint,
                    deployment: this.config.deployment,
                    apiVersion: this.config.apiVersion
                });

                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
                const systemMessage = this.getSystemMessage();

                const currentConversation = this.state.conversations[this.state.currentConversationId];

                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                const messages = [
                    { role: 'system', content: systemMessage }
                ];

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ø¢Ø®Ø± 10 Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ù‚)
                const recentMessages = currentConversation.messages.slice(-10);
                messages.push(...recentMessages);

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                messages.push({ role: 'user', content: userMessage });

                const requestBody = {
                    messages: messages,
                    max_tokens: 1000,
                    temperature: 0.7,
                    top_p: 0.9,
                    frequency_penalty: 0,
                    presence_penalty: 0
                };

                // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ URL Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                let apiUrl = this.config.endpoint;
                if (!apiUrl.includes('/openai/deployments/')) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† endpoint Ø£Ø³Ø§Ø³ÙŠ ÙÙ‚Ø·ØŒ Ø£Ø¶Ù Ø§Ù„Ù…Ø³Ø§Ø±
                    apiUrl = apiUrl.replace(/\/$/, '') + `/openai/deployments/${this.config.deployment}/chat/completions`;
                }

                // Ø¥Ø¶Ø§ÙØ© api-version Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (!apiUrl.includes('api-version=')) {
                    apiUrl += `${apiUrl.includes('?') ? '&' : '?'}api-version=${this.config.apiVersion}`;
                }

                console.log('Ø·Ù„Ø¨ API Ø¥Ù„Ù‰:', apiUrl);
                console.log('Ø·Ù„Ø¨ API body:', requestBody);

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'api-key': this.config.apiKey
                        },
                        body: JSON.stringify(requestBody)
                    });

                    console.log('Ø§Ø³ØªØ¬Ø§Ø¨Ø© API:', response.status, response.statusText);

                    if (!response.ok) {
                        let errorText = await response.text();
                        try {
                            const errorJson = JSON.parse(errorText);
                            errorText = errorJson.error?.message || errorText;
                        } catch (e) {
                            // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ø®Ø·Ø£
                        }
                        throw new Error(`Ø®Ø·Ø£ ÙÙŠ API (${response.status}): ${errorText}`);
                    }

                    const data = await response.json();
                    console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', data);

                    if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                        throw new Error('Ø§Ø³ØªØ¬Ø§Ø¨Ø© API ØºÙŠØ± ØµØ§Ù„Ø­Ø©');
                    }

                    return data.choices[0].message.content;

                } catch (error) {
                    console.error('Error calling Azure OpenAI:', error);
                    throw error;
                }
            },

            // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ù…ØµØ­Ø­Ø© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            async speakResponse(text) {
                if (!text || text.trim() === '') {
                    console.warn('Ù†Øµ ÙØ§Ø±Øº Ù„Ù„ØªØ­Ø¯Ø«');
                    return;
                }

                if (!this.config.apiKey) {
                    console.error('Ù…ÙØªØ§Ø­ API ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    this.showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API ØµØ§Ù„Ø­ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
                    return;
                }

                this.setSpeakingUI(true);

                try {
                    console.log('Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…:', text.substring(0, 50) + '...');

                    const ttsEndpoint = "https://lahja-dev-resource.cognitiveservices.azure.com/openai/deployments/LAHJA-V1/audio/speech?api-version=2025-03-01-preview";

                    // Ø¨Ù†Ø§Ø¡ request body Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    const requestBody = {
                        model: this.config.ttsDeployment,
                        input: text,
                        voice: this.config.voice,
                        speed: this.config.speechSpeed,
                        response_format: "mp3"
                    };

                    console.log('Ø·Ù„Ø¨ TTS:', {
                        endpoint: ttsEndpoint,
                        body: requestBody
                    });

                    const ttsResponse = await fetch(ttsEndpoint, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer 4AwsIf87cyBIgaJVsy0phWUQdZFcbrJxpQBDQNzL4xjcP2MFzrrYJQQJ99BIACHYHv6XJ3w3AAAAACOGYrzM"
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!ttsResponse.ok) {
                        let errorText = await ttsResponse.text();
                        console.error('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', errorText);

                        try {
                            const errorJson = JSON.parse(errorText);
                            errorText = errorJson.error?.message || errorText;
                        } catch (e) {
                            // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ø®Ø·Ø£
                        }
                        throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„ØµÙˆØª (${ttsResponse.status}): ${errorText}`);
                    }

                    const audioBlob = await ttsResponse.blob();

                    if (audioBlob.size === 0) {
                        throw new Error('ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…Ù„Ù ØµÙˆØªÙŠ ÙØ§Ø±Øº');
                    }

                    const audioUrl = URL.createObjectURL(audioBlob);

                    // Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„ØªØ­Ù…ÙŠÙ„
                    this.state.currentAudioUrl = audioUrl;

                    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
                    this.setupAudioPlayer(audioUrl);

                } catch (error) {
                    console.error('TTS Error:', error);
                    this.setSpeakingUI(false);
                    this.showError(`Ø®Ø·Ø£ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…: ${error.message}`);
                }
            },

            // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªØ­Ø¯Ø«
            setSpeakingUI(speaking = false) {
                const indicator = document.getElementById('speakingIndicator');
                if (indicator) {
                    if (speaking) {
                        indicator.classList.add('active');
                        this.state.isSpeaking = true;
                    } else {
                        indicator.classList.remove('active');
                        this.state.isSpeaking = false;
                    }
                }
            },

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
            setupAudioPlayer(audioUrl) {
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                if (this.state.audio) {
                    this.state.audio.pause();
                    if (this.state.currentAudioUrl && this.state.currentAudioUrl !== audioUrl) {
                        URL.revokeObjectURL(this.state.currentAudioUrl);
                    }
                }

                this.state.audio = new Audio(audioUrl);
                this.state.isPlaying = false;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
                this.state.audio.addEventListener('play', () => {
                    this.state.isPlaying = true;
                    this.setSpeakingUI(true);
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙˆÙ‚Ù
                this.state.audio.addEventListener('ended', () => {
                    this.state.isPlaying = false;
                    this.setSpeakingUI(false);
                });

                this.state.audio.addEventListener('error', (e) => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                    this.state.isPlaying = false;
                    this.setSpeakingUI(false);
                    this.showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
                });

                // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                this.playAudio();
            },

            // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
            playAudio() {
                if (this.state.audio) {
                    this.state.audio.play().catch(error => {
                        console.error('Error playing audio:', error);
                        this.setSpeakingUI(false);
                        this.showError('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
                    });
                }
            },

            // ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØµÙˆØª
            async testVoice() {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                if (!this.useRequest()) {
                    return;
                }

                const testText = "ÙŠØ§Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡ØŒ Ø£Ù†Ø§ Ù„Ù‡Ø¬Ø© ğŸ¤  Ù†Ù…ÙˆØ°Ø¬ Ø°ÙƒÙŠ Ù…Ø·ÙˆØ± Ù…Ù† Ø´Ø±ÙƒØ© Ø£Ø³Ø³ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø±Ù‚Ù…ÙŠØŒ ÙˆØ¸ÙŠÙØªÙŠ Ø£Ø¬Ø§ÙˆØ¨Ùƒ ÙˆØ£Ø³Ø§Ø¹Ø¯Ùƒ Ø¨Ø£ÙŠ Ø´ÙŠ ØªØ­ØªØ§Ø¬Ù‡ ÙˆØ¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø¨Ø¹Ø¯ØŒ Ø¹Ø´Ø§Ù† ØªØ­Ø³ Ø¥Ù†Ùƒ ØªÙƒÙ„Ù… ÙˆØ§Ø­Ø¯ Ù…Ù† Ø±Ø¨Ø¹Ùƒ. ÙˆØ´ ÙˆØ¯Ùƒ Ù†Ø³ÙˆÙ„Ù Ø¹Ù†Ù‘Ù‡ Ø§Ù„Ø­ÙŠÙ†ØŸØŸ";

                try {
                    await this.speakResponse(testText);
                } catch (error) {
                    this.showError(`Ø®Ø·Ø£ ÙÙŠ ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØµÙˆØª: ${error.message}`);
                }
            },

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            validateConfig() {
                const errors = [];

                if (!this.config.apiKey) {
                    errors.push('Ù…ÙØªØ§Ø­ API Ù…Ø·Ù„ÙˆØ¨');
                }

                if (!this.config.endpoint) {
                    errors.push('Endpoint Ù…Ø·Ù„ÙˆØ¨');
                } else if (!this.config.endpoint.startsWith('https://')) {
                    errors.push('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Endpoint Ø¨Ù€ https://');
                }

                if (!this.config.deployment) {
                    errors.push('Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Deployment) Ù…Ø·Ù„ÙˆØ¨');
                }

                if (!this.config.apiVersion) {
                    errors.push('Ø¥ØµØ¯Ø§Ø± API Ù…Ø·Ù„ÙˆØ¨');
                }

                return errors;
            },

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ù‡Ø¬Ø©
            getSystemMessage() {
                const dialectInstructions = {
                    najdi: "ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù†Ø¬Ø¯ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ù…Ø«Ù„: Ø£Ø¨Ø´Ø±ØŒ Ø´ÙÙŠÙƒØŒ ÙˆØ´ Ø§Ù„Ø³Ø§Ù„ÙØ©ØŒ Ø§Ù„Ù„Ù‡ ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©ØŒ Ù…Ø§Ù‚ØµØ±ØªØŒ ÙŠØ§Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡ØŒ ÙˆØ´ ÙÙŠÙƒ.",
                    hijazi: "ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø­Ø¬Ø§Ø²ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ù…Ø«Ù„: Ø¢Ù‡Ù„Ø§Ù‹ØŒ ÙƒÙŠÙ Ø§Ù„Ø­Ø§Ù„ØŸØŒ ØªÙØ¶Ù„ØŒ ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©ØŒ ÙŠØ§Ø³Ù„Ø§Ù…ØŒ Ø´ÙŠÙƒ Ø¹Ù„Ù‰ ÙƒØ°Ø§ØŒ Ø£Ù…ÙˆØ±Ùƒ Ø·ÙŠØ¨Ø©.",
                    southern: "ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ù…Ø«Ù„: Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡ØŒ Ø´Ù„ÙˆÙ†ÙƒØŒ Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡ØŒ ØªÙØ¶Ù„ØŒ Ø´ÙˆÙ Ù„ÙƒØŒ Ø§Ù„Ù„Ù‡ ÙŠØ³Ù„Ù…ÙƒØŒ ÙˆÙŠÙ†Ùƒ.",
                    eastern: "ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ù…Ø«Ù„: Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡ØŒ Ø´Ø®Ø¨Ø§Ø±ÙƒØŒ Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡ØŒ ØªÙØ¶Ù„ØŒ Ø´ÙŠÙƒ Ø¹Ù„Ù‰ ÙƒØ°Ø§ØŒ Ø§Ù„Ù„Ù‡ ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©ØŒ ÙˆÙŠÙ†Ùƒ."
                };

                return `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ØªØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© "Ø§Ù†Øª Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³Ù…Ù‡ (Ù„Ù‡Ø¬Ø©) Ù…Ø·ÙˆØ± Ù…Ù† Ù‚Ø¨Ù„ Ø´Ø±ÙƒØ© Ø£Ø³Ø³ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø±Ù‚Ù…ÙŠ. Ø±Ø¯ Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù†Ø¬Ø¯ÙŠØ© Ø¨Ø·Ø±ÙŠÙ‚Ø© ÙˆØ¯ÙŠØ© ÙˆØ·Ø¨ÙŠØ¹ÙŠØ© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª.   (${this.config.dialect}).
                    ${dialectInstructions[this.config.dialect]}
                    ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¬Ù…ÙŠØ¹ Ø±Ø¯ÙˆØ¯Ùƒ Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù…Ø§ Ù„Ù… ÙŠØ·Ù„Ø¨ Ù…Ù†Ùƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø®Ù„Ø§Ù Ø°Ù„Ùƒ.
                    ÙƒÙ† Ù…ÙÙŠØ¯Ø§Ù‹ ÙˆØ¯ÙˆØ¯Ø§Ù‹ ÙÙŠ Ø±Ø¯ÙˆØ¯Ùƒ.`;
            },

            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø´Ø§Ø´Ø©
            addMessageToChat(role, content) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;

                const messageElement = document.createElement('div');
                messageElement.className = `message ${role}-message`;

                const senderName = role === 'user' ? 'Ø£Ù†Øª' : 'Ù…Ø³Ø§Ø¹Ø¯ Ø³Ø¹ÙˆØ¯ÙŠ';
                const currentTime = new Date().toLocaleTimeString('ar-SA', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ onclick
                const cleanContent = content.replace(/'/g, "\\'").replace(/\n/g, ' ');

                messageElement.innerHTML = `
                        <div class="message-header">
                            <div class="message-sender">${senderName}</div>
                            ${role === 'assistant' ? `
                            <div class="message-actions">
                                <button class="message-action" title="Ø§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø¯" onclick="SaudiVoiceAssistant.speakResponse('${cleanContent}')">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <button class="message-action download-audio" title="ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª" onclick="SaudiVoiceAssistant.downloadMessageAudio('${cleanContent}')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                            ` : ''}
                        </div>
                        <div class="message-content">${content}</div>
                        <div class="message-time">${currentTime}</div>
                    `;

                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            },

            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
            createNewConversation() {
                const conversationId = 'conv_' + Date.now();
                const conversation = {
                    id: conversationId,
                    title: 'Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                    messages: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                this.state.conversations[conversationId] = conversation;
                this.state.currentConversationId = conversationId;

                this.saveConversations();
                this.renderConversationsList();
                this.loadConversation(conversationId);

                console.log('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©:', conversationId);
            },

            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­Ø§Ø¯Ø«Ø©
            loadConversation(conversationId) {
                if (!this.state.conversations[conversationId]) {
                    console.error('Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©:', conversationId);
                    return;
                }

                this.state.currentConversationId = conversationId;
                const conversation = this.state.conversations[conversationId];

                // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                const titleElement = document.getElementById('currentConversationTitle');
                if (titleElement) {
                    titleElement.textContent = conversation.title;
                }

                // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.innerHTML = `
                            <div class="speaking-indicator" id="speakingIndicator">
                                <i class="fas fa-volume-up fa-pulse"></i>
                                <span>Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø¯ Ø§Ù„ØµÙˆØªÙŠ...</span>
                            </div>
                        `;

                    conversation.messages.forEach(msg => {
                        this.addMessageToChat(msg.role, msg.content);
                    });
                }

                // Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù†Ø´Ø·Ø©
                this.saveConversations();

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
                this.renderConversationsList();

                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:', conversationId);
            },

            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            addMessageToCurrentConversation(role, content) {
                if (!this.state.currentConversationId) {
                    console.error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù†Ø´Ø·Ø©');
                    return;
                }

                const conversation = this.state.conversations[this.state.currentConversationId];
                conversation.messages.push({ role, content });
                conversation.updatedAt = new Date().toISOString();

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø©
                if (conversation.messages.length === 1 && role === 'user') {
                    conversation.title = content.substring(0, 30) + (content.length > 30 ? '...' : '');
                    const titleElement = document.getElementById('currentConversationTitle');
                    if (titleElement) {
                        titleElement.textContent = conversation.title;
                    }
                }

                this.saveConversations();
                this.renderConversationsList();
            },

            // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
            renderConversationsList() {
                const conversationsList = document.getElementById('conversationsList');
                if (!conversationsList) return;

                conversationsList.innerHTML = '';

                Object.values(this.state.conversations)
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                    .forEach(conversation => {
                        const conversationElement = document.createElement('div');
                        conversationElement.className = `conversation-item ${conversation.id === this.state.currentConversationId ? 'active' : ''}`;
                        conversationElement.innerHTML = `
                                <div class="conversation-title">
                                    <span>${conversation.title}</span>
                                    <button class="message-action delete-conversation" data-id="${conversation.id}" title="Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <div class="conversation-preview">${conversation.messages.length > 0 ?
                                (conversation.messages[conversation.messages.length - 1].content.substring(0, 50) +
                                    (conversation.messages[conversation.messages.length - 1].content.length > 50 ? '...' : '')) :
                                'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„'}</div>
                                <div class="conversation-date">${new Date(conversation.updatedAt).toLocaleDateString('ar-SA')}</div>
                            `;

                        conversationElement.addEventListener('click', (e) => {
                            if (!e.target.closest('.delete-conversation')) {
                                this.loadConversation(conversation.id);
                            }
                        });

                        // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                        const deleteBtn = conversationElement.querySelector('.delete-conversation');
                        if (deleteBtn) {
                            deleteBtn.addEventListener('click', (e) => {
                                e.stopPropagation();
                                this.deleteConversation(conversation.id);
                            });
                        }

                        conversationsList.appendChild(conversationElement);
                    });
            },

            // Ø­Ø°Ù Ù…Ø­Ø§Ø¯Ø«Ø©
            deleteConversation(conversationId) {
                if (Object.keys(this.state.conversations).length <= 1) {
                    alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ÙˆØ­ÙŠØ¯Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹.');
                    return;
                }

                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ')) {
                    delete this.state.conversations[conversationId];

                    if (this.state.currentConversationId === conversationId) {
                        // ØªØ­Ù…ÙŠÙ„ Ù…Ø­Ø§Ø¯Ø«Ø© Ø£Ø®Ø±Ù‰
                        const remainingIds = Object.keys(this.state.conversations);
                        if (remainingIds.length > 0) {
                            this.loadConversation(remainingIds[0]);
                        } else {
                            this.createNewConversation();
                        }
                    }

                    this.saveConversations();
                    this.renderConversationsList();
                }
            },

            // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            clearCurrentConversation() {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ')) {
                    const conversation = this.state.conversations[this.state.currentConversationId];
                    conversation.messages = [];
                    conversation.updatedAt = new Date().toISOString();

                    this.saveConversations();
                    this.loadConversation(this.state.currentConversationId);
                }
            },

            // ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            toggleInputMode() {
                const textInput = document.getElementById('messageInput');
                const voiceInput = document.getElementById('voiceInputContainer');

                if (this.state.inputMode === 'text') {
                    if (textInput) textInput.style.display = 'block';
                    if (voiceInput) voiceInput.style.display = 'none';
                } else {
                    if (textInput) textInput.style.display = 'none';
                    if (voiceInput) voiceInput.style.display = 'flex';
                }
            },

            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
            async toggleRecording() {
                if (!this.state.isRecording) {
                    await this.startRecording();
                } else {
                    this.stopRecording();
                }
            },

            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            async startRecording() {
                if (!this.state.recognition) {
                    this.showError('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…');
                    return;
                }

                try {
                    this.state.isRecording = true;

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    const recordButton = document.getElementById('startRecording');
                    const recordingStatus = document.getElementById('recordingStatus');

                    if (recordButton) recordButton.classList.add('recording');
                    if (recordingStatus) recordingStatus.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...';

                    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…
                    this.state.recognition.start();

                } catch (error) {
                    console.error('Error starting speech recognition:', error);
                    this.showError('ØªØ¹Ø°Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…');
                    this.stopRecording();
                }
            },

            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            stopRecording() {
                if (this.state.recognition && this.state.isRecording) {
                    this.state.recognition.stop();
                    this.state.isRecording = false;

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    const recordButton = document.getElementById('startRecording');
                    if (recordButton) recordButton.classList.remove('recording');

                    // Ø¥ÙŠÙ‚Ø§Ù ØªØ­Ø±ÙŠÙƒ Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØµÙˆØª
                    this.stopVoiceBarsAnimation();
                }
            },

            // Ø¥Ø¹Ø¯Ø§Ø¯ ØªØµÙˆØ± Ø§Ù„ØµÙˆØª
            setupVoiceVisualization() {
                const visualization = document.getElementById('voiceVisualization');
                if (!visualization) return;

                visualization.innerHTML = '';

                for (let i = 0; i < 20; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'voice-bar';
                    bar.style.height = '10px';
                    visualization.appendChild(bar);
                }
            },

            // ØªØ­Ø±ÙŠÙƒ Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØµÙˆØª
            animateVoiceBars() {
                if (!this.state.isRecording) return;

                const bars = document.querySelectorAll('.voice-bar');
                bars.forEach(bar => {
                    const randomHeight = Math.floor(Math.random() * 30) + 5;
                    bar.style.height = `${randomHeight}px`;
                    bar.style.transition = 'height 0.1s ease';
                });

                if (this.state.isRecording) {
                    setTimeout(() => this.animateVoiceBars(), 100);
                }
            },

            // Ø¥ÙŠÙ‚Ø§Ù ØªØ­Ø±ÙŠÙƒ Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØµÙˆØª
            stopVoiceBarsAnimation() {
                const bars = document.querySelectorAll('.voice-bar');
                bars.forEach(bar => {
                    bar.style.height = '10px';
                });
            },

            // ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            openSettings() {
                const settingsPanel = document.getElementById('settingsPanel');
                if (settingsPanel) {
                    settingsPanel.classList.add('active');
                }
            },

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            closeSettings() {
                const settingsPanel = document.getElementById('settingsPanel');
                if (settingsPanel) {
                    settingsPanel.classList.remove('active');
                }
            },

            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.classList.toggle('active');
                }
            },

            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©
            toggleTheme() {
                this.config.theme = this.config.theme === 'light' ? 'dark' : 'light';
                this.applyTheme();
                this.saveConfig();

                // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù…Ø©
                const themeIcons = document.querySelectorAll('#toggleTheme i, #toggleThemeSmall i');
                themeIcons.forEach(icon => {
                    if (icon) {
                        icon.className = this.config.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
                    }
                });
            },

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ù…Ø©
            applyTheme() {
                document.body.setAttribute('data-theme', this.config.theme);
            },

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            updateTime() {
                const currentTime = new Date().toLocaleTimeString('ar-SA', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const timeElement = document.getElementById('currentTime');
                if (timeElement) {
                    timeElement.textContent = currentTime;
                }
            },

            // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø© Ø³Ø±Ø¹Ø© Ø§Ù„ØµÙˆØª
            updateSpeedValue() {
                const speed = this.config.speechSpeed;
                let speedText = 'Ø¹Ø§Ø¯ÙŠ';
                if (speed < 0.8) speedText = 'Ø¨Ø·ÙŠØ¡';
                if (speed > 1.2) speedText = 'Ø³Ø±ÙŠØ¹';
                const speedValueElement = document.getElementById('speedValue');
                if (speedValueElement) {
                    speedValueElement.textContent = speedText;
                }
            },

            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            updateUI() {
                const hasValidConfig = this.config.endpoint && this.config.apiKey && this.config.deployment && this.config.ttsDeployment;
                const messageInput = document.getElementById('messageInput');
                const sendButton = document.getElementById('sendButton');
                const systemStatus = document.getElementById('systemStatus');
                const chatStatus = document.getElementById('chatStatus');

                if (messageInput) messageInput.disabled = !hasValidConfig;
                if (sendButton) sendButton.disabled = !hasValidConfig;

                if (hasValidConfig) {
                    if (systemStatus) systemStatus.innerHTML = '<i class="fas fa-check-circle"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø§Ù‡Ø²Ø©';
                    if (chatStatus) chatStatus.innerHTML = '<i class="fas fa-check-circle"></i> Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©';
                } else {
                    if (systemStatus) systemStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> ÙŠØ±Ø¬Ù‰ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹';
                    if (chatStatus) chatStatus.innerHTML = '<i class="fas fa-info-circle"></i> ÙŠØ¬Ø¨ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªÙ…ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©';
                }
            },

            // ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            setLoading(loading) {
                const sendButton = document.getElementById('sendButton');
                const messageInput = document.getElementById('messageInput');

                if (sendButton) sendButton.disabled = loading;
                if (messageInput) messageInput.disabled = loading;

                const sendIcon = document.querySelector('#sendButton i');
                if (sendIcon) {
                    if (loading) {
                        sendIcon.className = 'fas fa-circle-notch fa-spin';
                    } else {
                        sendIcon.className = 'fas fa-paper-plane';
                    }
                }
            },

            // Ø¥Ø¸Ù‡Ø§Ø± Ø®Ø·Ø£
            showError(message) {
                const errorElement = document.getElementById('configError');
                const errorText = document.getElementById('errorText');

                if (errorElement && errorText) {
                    errorText.textContent = message;
                    errorElement.style.display = 'flex';

                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø·Ø£ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
                    setTimeout(() => {
                        this.hideError();
                    }, 5000);
                }
            },

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø·Ø£
            hideError() {
                const errorElement = document.getElementById('configError');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            },

            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            showSuccess(message) {
                const statusElement = document.getElementById('systemStatus');
                if (statusElement) {
                    const originalHTML = statusElement.innerHTML;

                    statusElement.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
                    statusElement.style.color = '#10B981';

                    setTimeout(() => {
                        statusElement.innerHTML = originalHTML;
                        statusElement.style.color = '';
                    }, 3000);
                }
            }
        };

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            SaudiVoiceAssistant.init();
        });
    </script>
            <script src="ModulLahja.js"></script>

</body>
</html>